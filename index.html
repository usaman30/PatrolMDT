<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>PatrolCAD v2.2 – Full System</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: #1b1f23;
      color: #e0e0e0;
    }
    .centered {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background-color: #121417;
    }
    .login-box {
      background-color: #263238;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 0 20px #000;
    }
    .login-box input, .login-box button {
      padding: 10px;
      margin: 8px 0;
      width: 100%;
      background: #1b1f23;
      color: white;
      border: 1px solid #90caf9;
      border-radius: 4px;
    }
    .login-box button {
      background-color: #0d47a1;
    }
    .dashboard {
      padding: 20px;
    }
    .button-bar {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 15px;
    }
    button {
      padding: 10px;
      background-color: #1565c0;
      border: none;
      color: white;
      border-radius: 4px;
      cursor: pointer;
    }
    .section {
      background-color: #263238;
      padding: 15px;
      border-radius: 6px;
      margin-bottom: 15px;
    }
    .output {
      white-space: pre-wrap;
      background-color: #1e272e;
      padding: 10px;
      border: 1px solid #90caf9;
      border-radius: 4px;
      margin-top: 10px;
    }
    .hidden {
      display: none;
    }
    input, textarea, select {
      width: 100%;
      margin-top: 5px;
      margin-bottom: 10px;
      padding: 8px;
      background-color: #1b1f23;
      border: 1px solid #90caf9;
      color: white;
      border-radius: 4px;
    }
    .log-terminal {
      background: #121417;
      padding: 10px;
      height: 200px;
      overflow-y: auto;
      font-family: monospace;
      font-size: 0.9em;
      border: 1px solid #90caf9;
      border-radius: 4px;
    }
    .flag {
      color: red;
      font-weight: bold;
    }
  </style>
</head>
<body>

<!-- LOGIN -->
<div id="loginScreen" class="centered">
  <div class="login-box">
    <h2>PatrolCAD Access</h2>
    <input type="text" id="officerName" placeholder="Officer Name">
    <input type="text" id="callsign" placeholder="Callsign (e.g. 204)">
    <button id="loginBtn">Login</button>
    <button id="bypassBtn">Bypass Login</button>
  </div>
</div>

<!-- DASHBOARD -->
<div id="mainDashboard" class="hidden">
  <header style="background:#0d47a1; padding:10px; color:white; font-weight:bold;">
    PatrolCAD – <span id="unitDisplay"></span>
  </header>

  <div class="dashboard">
    <div class="button-bar">
      <select id="statusSelector" onchange="updateStatus()">
        <option value="10-8">10-8 (Available)</option>
        <option value="10-76">10-76 (En Route)</option>
        <option value="10-23">10-23 (On Scene)</option>
        <option value="10-6">10-6 (Busy)</option>
        <option value="10-7">10-7 (Off Duty)</option>
      </select>
      <button onclick="toggleSection('ncicSection')">NCIC Search</button>
      <button onclick="toggleSection('plateSection')">Plate Search</button>
      <button onclick="toggleSection('citationSection')">Write Citation</button>
      <button onclick="generateCall()">Generate Call</button>
      <button onclick="clearCall()">Clear Call</button>
    </div>

    <div class="section">
      <h3>Status & Dispatch Log</h3>
      <div id="dispatchLog" class="log-terminal"></div>
    </div>

    <div class="section">
      <h3>Current Assignment</h3>
      <div id="currentCall">No current assignment.</div>
    </div>

    <div class="section">
      <h3>Active Calls</h3>
      <div id="activeCallList"></div>
    </div>
    
        <div id="ncicSection" class="section hidden">
      <h3>NCIC Search</h3>
      <input type="text" id="ncicInput" placeholder="Last, First, M., DOB">
      <button onclick="searchNCIC()">Search</button>
      <div id="ncicResult" class="output"></div>
    </div>

    <div id="plateSection" class="section hidden">
      <h3>License Plate Search</h3>
      <input type="text" id="plateInput" placeholder="Plate Number, State">
      <button onclick="searchPlate()">Search</button>
      <div id="plateResult" class="output"></div>
    </div>

    <div id="citationSection" class="section hidden">
      <h3>Write Citation</h3>
      <input type="text" id="violatorName" placeholder="Violator Name">
      <input type="text" id="violatorDOB" placeholder="DOB (MM/DD/YYYY)">
      <input type="text" id="violation" placeholder="Violation">
      <input type="text" id="location" placeholder="Location">
      <input type="number" id="fine" placeholder="Fine Amount ($)">
      <textarea id="notes" placeholder="Notes..."></textarea>
      <button onclick="generateCitation()">Generate Citation</button>
      <div id="citationLog" class="output"></div>
    </div>
  </div>
</div>

<audio id="alertSound" preload="auto">
  <source src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg" type="audio/ogg">
</audio>

<script>
let currentOfficer = '';
let citationCount = 1000;
let log = [];

document.addEventListener("DOMContentLoaded", () => {
  document.getElementById("loginBtn").addEventListener("click", login);
  document.getElementById("bypassBtn").addEventListener("click", bypassLogin);
});

function login() {
  const name = document.getElementById("officerName").value.trim();
  const callsign = document.getElementById("callsign").value.trim();
  if (!name || !callsign) return alert("Please enter both fields.");
  currentOfficer = `Unit ${callsign} – ${name}`;
  finishLogin();
}

function bypassLogin() {
  currentOfficer = "Unit 204 – Demo";
  finishLogin();
}

function finishLogin() {
  document.getElementById("loginScreen").classList.add("hidden");
  document.getElementById("mainDashboard").classList.remove("hidden");
  document.getElementById("unitDisplay").textContent = currentOfficer;
  addLog(`Login successful as ${currentOfficer}`);
}

function updateStatus() {
  const status = document.getElementById("statusSelector").value;
  addLog(`${currentOfficer} status set to ${status}`);
}

function toggleSection(id) {
  document.getElementById(id).classList.toggle("hidden");
}

function addLog(entry) {
  const time = new Date().toLocaleTimeString();
  log.push(`[${time}] ${entry}`);
  const logBox = document.getElementById("dispatchLog");
  logBox.innerText = log.slice(-50).join("\n");
  logBox.scrollTop = logBox.scrollHeight;
}

function generateCall() {
  const callID = Math.floor(1000 + Math.random() * 9000);
  const type = ["Burglary", "DV Verbal", "Suspicious Person", "Disturbance"][Math.floor(Math.random() * 4)];
  const location = ["302 S Main St", "119 E 17th Ave", "4321 Raytown Rd", "839 Oak Tree Ln"][Math.floor(Math.random() * 4)];
  const priority = ["Level 1 – Urgent", "Level 2 – Semi-Urgent", "Level 3 – Low Urgency"][Math.floor(Math.random() * 3)];
  const rp = ["Kevin Jackson", "Maria Reed", "Neighbor", "Anonymous"][Math.floor(Math.random() * 4)];
  const time = new Date().toLocaleTimeString();

  const call = {
    id: callID,
    title: type,
    location: location,
    priority: priority,
    rp: rp,
    time: time
  };

  document.getElementById("currentCall").innerText =
    `Call ID: ${call.id}\nTitle: ${call.title}\nPriority: ${call.priority}\nLocation: ${call.location}\nRP: ${call.rp}\nTime: ${call.time}`;

  const callDiv = document.createElement("div");
  callDiv.className = "output";
  callDiv.innerText = `Call ID: ${call.id}\n${call.title} at ${call.location}\nUnits: 204\nTime: ${call.time}`;
  document.getElementById("activeCallList").appendChild(callDiv);

  document.getElementById("alertSound").play();
  addLog(`${currentOfficer} assigned to call ${call.id}`);

  setTimeout(() => callDiv.remove(), 180000);
}

function clearCall() {
  const display = document.getElementById("currentCall");
  if (display.innerText.includes("Call ID")) {
    addLog(`${currentOfficer} cleared their call`);
    display.innerText = "No current assignment.";
  } else {
    alert("No active call to clear.");
  }
}

function searchNCIC() {
  const val = document.getElementById("ncicInput").value.trim();
  let result = `Search results