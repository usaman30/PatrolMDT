<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>PatrolCAD v2.1 – Tactical Dashboard</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: #1b1f23;
      color: #e0e0e0;
    }
    .centered {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background-color: #121417;
    }
    .login-box {
      background-color: #263238;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 0 20px #000;
    }
    .login-box input {
      padding: 10px;
      margin: 8px 0;
      width: 100%;
      background: #1b1f23;
      color: white;
      border: 1px solid #90caf9;
      border-radius: 4px;
    }
    .login-box button {
      padding: 10px;
      width: 100%;
      background-color: #0d47a1;
      border: none;
      color: white;
      border-radius: 4px;
      margin-top: 10px;
      cursor: pointer;
    }
    header {
      background-color: #0d47a1;
      padding: 10px;
      text-align: center;
      font-size: 1.3em;
      color: white;
      font-weight: bold;
    }
    .dashboard {
      padding: 20px;
    }
    .button-bar {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 15px;
    }
    button {
      padding: 10px;
      background-color: #1565c0;
      border: none;
      color: white;
      border-radius: 4px;
      cursor: pointer;
    }
    .section {
      background-color: #263238;
      padding: 15px;
      border-radius: 6px;
      margin-bottom: 15px;
    }
    .output {
      white-space: pre-wrap;
      background-color: #1e272e;
      padding: 10px;
      border: 1px solid #90caf9;
      border-radius: 4px;
      margin-top: 10px;
    }
    .hidden {
      display: none;
    }
    input, textarea, select {
      width: 100%;
      margin-top: 5px;
      margin-bottom: 10px;
      padding: 8px;
      background-color: #1b1f23;
      border: 1px solid #90caf9;
      color: white;
      border-radius: 4px;
    }
    .log-terminal {
      background: #121417;
      padding: 10px;
      height: 200px;
      overflow-y: auto;
      font-family: monospace;
      font-size: 0.9em;
      border: 1px solid #90caf9;
      border-radius: 4px;
    }
    .flag {
      color: red;
      font-weight: bold;
    }
  </style>
</head>
<body>

<div id="loginScreen" class="centered">
  <div class="login-box">
    <h2>PatrolCAD Access</h2>
    <input type="text" id="officerName" placeholder="Officer Name">
    <input type="text" id="callsign" placeholder="Callsign (e.g. 204)">
    <button onclick="login()">Login</button>
  </div>
</div>

<div id="mainDashboard" class="hidden">
  <header>
    PatrolCAD v2.1 – <span id="unitDisplay"></span>
  </header>
  <div class="dashboard">
    <div class="button-bar">
      <select id="statusSelector" onchange="updateStatus()">
        <option value="10-8">10-8 (Available)</option>
        <option value="10-76">10-76 (En Route)</option>
        <option value="10-23">10-23 (On Scene)</option>
        <option value="10-6">10-6 (Busy)</option>
        <option value="10-7">10-7 (Off Duty)</option>
      </select>
      <button onclick="toggleSection('ncicSection')">NCIC Search</button>
      <button onclick="toggleSection('plateSection')">LP Search</button>
      <button onclick="toggleSection('citationSection')">Write Citation</button>
      <button onclick="generateCall()">Generate Call</button>
    </div>

    <div class="section">
      <h3>Status & Log</h3>
      <div id="dispatchLog" class="log-terminal"></div>
    </div>

    <div class="section">
      <h3>Current Assignment</h3>
      <div id="currentCall">No current assignment.</div>
    </div>

    <div class="section">
      <h3>Active Calls</h3>
      <div id="activeCallList"></div>
    </div>
    
        <div id="ncicSection" class="section hidden">
      <h3>NCIC Search</h3>
      <input type="text" id="ncicInput" placeholder="Last, First, M., DOB">
      <button onclick="searchNCIC()">Search</button>
      <div id="ncicResult" class="output"></div>
    </div>

    <div id="plateSection" class="section hidden">
      <h3>License Plate Search</h3>
      <input type="text" id="plateInput" placeholder="Plate Number, State">
      <button onclick="searchPlate()">Search</button>
      <div id="plateResult" class="output"></div>
    </div>

    <div id="citationSection" class="section hidden">
      <h3>Write Citation</h3>
      <input type="text" id="violatorName" placeholder="Violator Name">
      <input type="text" id="violatorDOB" placeholder="DOB (MM/DD/YYYY)">
      <input type="text" id="violation" placeholder="Violation">
      <input type="text" id="location" placeholder="Location">
      <input type="number" id="fine" placeholder="Fine Amount ($)">
      <textarea id="notes" placeholder="Notes..."></textarea>
      <button onclick="generateCitation()">Generate Citation</button>
      <div id="citationLog" class="output"></div>
    </div>
  </div>
</div>

<audio id="alertSound" preload="auto">
  <source src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAAZGF0YYQAAAAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA" type="audio/wav">
</audio>

<script>
let citationCount = 1000;
let currentOfficer = '';
let log = [];

function login() {
  const name = document.getElementById("officerName").value;
  const callsign = document.getElementById("callsign").value;
  if (name && callsign) {
    currentOfficer = `Unit ${callsign} – ${name}`;
    document.getElementById("loginScreen").classList.add("hidden");
    document